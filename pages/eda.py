import streamlit as st
import pandas as pd
import io
from edaUtils import get_basic_info, get_num_cat_describe, clean_duplicates, object_to_numeric_and_fillna,corr_graph, phik_corr, brand_plot, class_plot, pairplots
import warnings
warnings.filterwarnings('ignore')

st.set_page_config(page_title="EDA", page_icon="üìä", layout="wide")
st.title("üìä EDA | –†–∞–∑–≤–µ–¥–æ—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö")
st.markdown("---")

@st.cache_data
def load_data():
    try:
        df = pd.read_csv('data/train_data.csv')
        return df
    except FileNotFoundError:
        st.error("–§–∞–π–ª data/train_data.csv –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        return None


df = load_data()

if df is None:
    st.stop()

with st.sidebar:
    st.header("–ù–∞—Å—Ç—Ä–æ–π–∫–∏")
    sample_type = st.radio("–¢–∏–ø –≤—ã–±–æ—Ä–∫–∏:",["–ü–µ—Ä–≤—ã–µ n —Å—Ç—Ä–æ–∫", "–ü–æ—Å–ª–µ–¥–Ω–∏–µ n —Å—Ç—Ä–æ–∫", "–°–ª—É—á–∞–π–Ω—ã–µ n —Å—Ç—Ä–æ–∫"])
    sample_size = st.slider("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫:", min_value=5, max_value=100, value=10)
    st.subheader("–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏")
    show_corr = st.checkbox("–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –º–∞—Ç—Ä–∏—Ü—ã", value=True)
    if show_corr:
        corr_method = st.selectbox("–ú–µ—Ç–æ–¥ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏:",["pearson", "spearman", "phik"])
    show_brand_plot = st.checkbox("–ì—Ä–∞—Ñ–∏–∫ –º–∞—Ä–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π", value=True)
    show_class_plot = st.checkbox("–ì—Ä–∞—Ñ–∏–∫ –∫–ª–∞—Å—Å–æ–≤ (—Ü–µ–Ω–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π)", value=True)
    show_pairplot = st.checkbox("–ü–æ–ø–∞—Ä–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è", value=True)


st.metric("–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫", df.shape[0])
st.metric("–í—Å–µ–≥–æ –∫–æ–ª–æ–Ω–æ–∫", df.shape[1])
st.markdown("---")

st.header("1. –ë–∞–∑–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏")
basic_info = get_basic_info(df)
for i in basic_info:
    st.write(f"‚Ä¢ {i}")

with st.expander("–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞—á–µ–Ω–∏–π"):
    buffer = io.StringIO()
    df.info(buf=buffer)
    info_str = buffer.getvalue()
    st.code(info_str, language='text')


with st.expander("–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö"):
    num_describe, cat_describe = get_num_cat_describe(df)
    st.subheader("–ß–∏—Å–ª–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏")
    st.dataframe(num_describe, width='stretch')
    st.subheader("–ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏")
    st.dataframe(cat_describe, width='stretch')
    st.text("–ò–º–µ–µ—Ç—Å—è –Ω–µ–±–æ–ª—å—à–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (7%) –∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤ (1.1%) , —á—Ç–æ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—á–µ–Ω—å –º–∞–ª—É—é –¥–æ–ª—é –æ—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö.–í —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è—Ö –º–Ω–æ–≥–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ –≤–∏–¥–µ–Ω –ø–µ—Ä–µ–∫–æ—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–≥–æ–¥ –º–∞—à–∏–Ω—ã - –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 2010 –¥–æ 2020, —Ü–µ–Ω–∞ - –Ω–∞–æ–±–æ—Ä–æ—Ç, —Å–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –ª–µ–≤–æ–π —á–∞—Å—Ç–∏ –≥—Ä–∞—Ñ–∏–∫–∞, —Ç–æ–ø–ª–∏–≤–æ - –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ diesel –∏ petrol, –∏ —Ç.–¥.). –í —Ü–µ–ª–æ–º, –¥–∞–Ω–Ω—ã–µ, —Ö–æ—Ç—å –∏ –Ω–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã, —Ö–æ—Ä–æ—à–æ –æ—Ç—Ä–∞–∂–∞—é—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂–∏ –º–∞—à–∏–Ω. –î–∏—Å–±–∞–ª–∞–Ω—Å –≤ –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö –Ω–∞—Å—Ç–æ—Ä–∞–∂–∏–≤–∞–µ—Ç —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ '–ø—Ä–µ–¥—É–±–µ–∂–¥–µ–Ω–∏—è' (bias —Å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ, –Ω–æ –Ω–µ –≤ –∑–Ω–∞—á–µ–Ω–∏–∏ –¥–æ–±–∞–≤–æ—á–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –Ω–µ –º–æ–≥—É –ª—É—á—à–µ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏) –≤ –±—É–¥—É—â–µ–π –º–æ–¥–µ–ª–∏. –ê –≤–æ—Ç –Ω–∞—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –æ—Ç—Ä–∞–∑–∏—Ç—Å—è –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ –º–æ–¥–µ–ª–∏ —É–∑–Ω–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ :)")
st.markdown("---")

st.header("2. –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö")

with st.spinner("–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."):
    df_cleaned = df.copy()
    progress_bar = st.progress(0)
    progress_bar.progress(30)
    df_cleaned = clean_duplicates(df_cleaned)
    progress_bar.progress(70)
    df_cleaned = object_to_numeric_and_fillna(df_cleaned)
    progress_bar.progress(100)
    st.success(f"‚úÖ –î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã! –û—Å—Ç–∞–ª–æ—Å—å —Å—Ç—Ä–æ–∫: {df_cleaned.shape[0]}")
    with st.expander("–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö"):
        num_describe, cat_describe = get_num_cat_describe(df_cleaned)
        st.subheader("–ß–∏—Å–ª–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏")
        st.dataframe(num_describe, width='stretch')
        st.subheader("–ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏")
        st.dataframe(cat_describe, width='stretch')
        st.text("–ù–µ—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–¥–≤–∏–≥ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è—Ö –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ –µ—Å—Ç—å (–µ–¥–≤–∞ –ª–∏ –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è), –Ω–æ –æ–Ω –≤–æ–∑–Ω–∏–∫ —Å–∫–æ—Ä–µ–µ –∏–∑-–∑–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, —á–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤. –¢–∞–∫ –∫–∞–∫ –∑–∞–ø–æ–ª–Ω—è–ª–∏ –º–µ–¥–∏–∞–Ω–æ–π, 50% –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–µ–º, —Ç–æ –∏–∑ —Å–∞–º–æ–≥–æ –µ—ë –æ–ø—Ä–µ–¥–µ–ª–Ω–∏—è —Å–ª–µ–¥—É–µ—Ç, —á—Ç–æ —Å–¥–≤–∏–Ω—É—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–Ω–∞ –Ω–µ –º–æ–≥–ª–∞.")

st.markdown("---")

st.header("3. –ü—Ä–∏–º–µ—Ä –æ—á–∏—â–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö")

if sample_type == "–ü–µ—Ä–≤—ã–µ n —Å—Ç—Ä–æ–∫":
    sample_df = df_cleaned.head(sample_size)
    st.write(f"**–ü–µ—Ä–≤—ã–µ {sample_size} —Å—Ç—Ä–æ–∫:**")
elif sample_type == "–ü–æ—Å–ª–µ–¥–Ω–∏–µ n —Å—Ç—Ä–æ–∫":
    sample_df = df_cleaned.tail(sample_size)
    st.write(f"**–ü–æ—Å–ª–µ–¥–Ω–∏–µ {sample_size} —Å—Ç—Ä–æ–∫:**")
else:
    sample_df = df_cleaned.sample(sample_size, random_state=42)
    st.write(f"**–°–ª—É—á–∞–π–Ω—ã–µ {sample_size} —Å—Ç—Ä–æ–∫:**")

st.dataframe(sample_df, width='stretch')

csv = df_cleaned.to_csv(index=False).encode('utf-8')
st.download_button(label="–°–∫–∞—á–∞—Ç—å –æ—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (CSV)", data=csv, file_name='cleaned_car_data.csv', mime='text/csv')
st.markdown("---")

st.header("4. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏")

if show_corr:
    st.subheader("–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –º–∞—Ç—Ä–∏—Ü—ã")
    st.markdown("""
        **Pearson**: –õ–∏–Ω–µ–π–Ω–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –º–µ–∂–¥—É –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏  
        **Spearman**: –†–∞–Ω–≥–æ–≤–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è (–º–æ–Ω–æ—Ç–æ–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å)  
        **Phi-k**: –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –¥–ª—è —Å–º–µ—à–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö (—á–∏—Å–ª–æ–≤—ã–µ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ)
    """)

    if corr_method in ['pearson', 'spearman']:
        fig = corr_graph(df_cleaned, method=corr_method)
        if fig:
            st.pyplot(fig)
        else:
            st.error(f"–ú–µ—Ç–æ–¥ {corr_method} –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è")
    elif corr_method == 'phik':
        with st.spinner('–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏–∫–∞ phik –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è...'):
            fig = phik_corr(df_cleaned)
        if fig:
            st.pyplot(fig)
            st.markdown(""" 
    –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (**–Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω–∞ —Ç—É—Ç, —Ç–∞–∫ –∫–∞–∫ –≤ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–º –Ω–æ—É—Ç–±—É–∫–µ –≤—ã—á–∏—Å–ª—è–ª–æ—Å—å –Ω–∞ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–º —Å—Ç–æ–ª–±—Ü–µ name, –Ω–æ –∑–¥–æ—Ä–æ–≤–æ –≤–∏–¥–µ—Ç—å –±–æ–ª–µ–µ –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**):
    - –¥–æ–≤–æ–ª—å–Ω–æ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ –≤—ã–¥–µ–ª–µ–Ω–∞ —Å–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å –∏–º–µ–Ω–∏ –∏ –ø–æ—á—Ç–∏ –≤—Å–µ—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –≤–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –±–æ–ª—å—à–æ–π –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å—é –≤ —ç—Ç–æ–π –∫–æ–ª–æ–Ω–∫–µ, –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —á–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å–∫–∞–∑–∏–ª–∏—Å—å
    - –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, —á—Ç–æ –∑–¥–µ—Å—å –≥–æ—Ä–∞–∑–¥–æ –Ω–∏–∂–µ –æ—Ü–µ–Ω–µ–Ω–∞ —Å–≤—è–∑—å –≥–æ–¥–∞ –≤—ã–ø—É—Å–∫–∞ –∏ km_driven, –≤–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ —É –Ω–∏—Ö –æ–±—Ä–∞—Ç–Ω–∞—è –ª–∏–Ω–µ–π–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
    - –∑–∞—Ç–æ –º–æ–∂–Ω–æ –≤—ã—è–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –≤ —Ç–æ–º —á–∏—Å–ª–µ –∏ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏: max_torque_rpm –∏ fuel, owner –∏ selling_price (—Å–ª–∞–±–∞—è, –Ω–æ –µ—Å—Ç—å)
    - –≤ –æ—Å—Ç–∞–ª—å–Ω–æ–º, –ø—Ä–æ—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–µ –∂–µ —Å–≤—è–∑–∏, —á—Ç–æ –∏ –≤ —Ç–∞–±–ª–∏—Ü–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π –ü–∏—Ä—Å–æ–Ω–∞ –∏ –°–ø–∏—Ä–º–µ–Ω–∞
            """)
        else:
            st.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ Phi-k –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏")

if show_brand_plot:
    st.subheader("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–Ω –ø–æ –º–∞—Ä–∫–∞–º")
    st.text("–í–∏–¥–Ω–æ –º–∞–ª–æ–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–∞—Ä–æ–∫ –º–∞—à–∏–Ω (–≤—Å–µ –ø–æ—Å–ª–µ –Ω–∏—Å—Å–∞–Ω–∞). –ó–∞–º–µ—Ç–Ω—ã –≤—ã–±—Ä–æ—Å—ã + –Ω–µ–∫–æ—Ç–æ—Ä–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Ü–µ–Ω—ã –æ—Ç –±—Ä–µ–Ω–¥–∞ (–∫–∞–∫ –º–∏–Ω–∏–º—É–º, –≤–∏–¥–µ–Ω –¥–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–∞—Ä–æ–∫).")
    fig = brand_plot(df_cleaned)
    st.pyplot(fig)

if show_class_plot:
    st.subheader("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–ª–∞—Å—Å–∞–º (—Ü–µ–Ω–æ–≤—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º)")
    st.markdown("""
    –í—ã–¥–µ–ª–∏–º —á–µ—Ç—ã—Ä–µ –≥—Ä—É–ø–ø—ã:
    - –±—é–¥–∂–µ—Ç–Ω—ã–µ –∞–≤—Ç–æ (–º–µ–¥–∏–∞–Ω–∞ < 200 000)
    - –Ω–∏–∑—à–∏–π —ç–∫–æ–Ω–æ–º –∫–ª–∞—Å—Å (200 000 < –º–µ–¥–∏–∞–Ω–∞ < 500 000)
    - –≤–µ—Ä—Ö–Ω–∏–π —ç–∫–æ–Ω–æ–º –∫–ª–∞—Å—Å (500 000 < –º–µ–¥–∏–∞–Ω–∞ < 1000 000)
    - –±–∏–∑–Ω–µ—Å –∫–ª–∞—Å—Å (1000 000 < –º–µ–¥–∏–∞–Ω–∞)
    
    –≠–∫–æ–Ω–æ–º –∫–ª–∞—Å—Å —Ä–∞–∑–¥–µ–ª–∏–ª—Å—è –Ω–∞ 2, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ–≤–æ–ª—å–Ω–æ —à–∏—Ä–æ–∫—É—é –ø—Ä–æ—Å–ª–æ–π–∫—É –∏ –ª—é–¥–∏ –≤–Ω—É—Ç—Ä–∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –∫–ª–∞—Å—Å–∞, —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é —Ç–∞–∫–∏—Ö –º–∞—à–∏–Ω, —Ç–æ–∂–µ —Å–∏–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è - –Ω–µ –∑—Ä—è –≤—ã–¥–µ–ª—è—é—Ç –≤–µ—Ä—Ö–Ω–∏–π –∏ –Ω–∏–∑—à–∏–π —Å—Ä–µ–¥–Ω–∏–π –∫–ª–∞—Å—Å.
    """)
    fig = class_plot(df_cleaned)
    st.pyplot(fig)
    st.text("–í–∏–¥–Ω–æ —è–≤–Ω—ã–π –ø–µ—Ä–µ–∫–æ—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É –Ω–∏–∑—à–µ–≥–æ —ç–∫–æ–Ω–æ–º –∫–ª–∞—Å—Å–∞, –æ—Ç–∫—É–¥–∞ —Å–ª–µ–¥—É–µ—Ç, —á—Ç–æ –∏ —Ü–µ–Ω—ã –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ 200 000 - 500 000 –Ω–∞–∏–±–æ–ª–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã. –≠—Ç–æ –º–æ–∂–µ—Ç —Å–∏–ª—å–Ω–æ –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ —Ä–∞–±–æ—Ç—É –º–æ–¥–µ–ª–∏. –ü–æ—Ö–æ–∂–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –ø–æ–ª—É—á–∏—Ç—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–º boxplot'–æ–º, –Ω–æ —Ç–∞–∫ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –Ω–∞–≥–ª—è–¥–Ω–µ–µ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ —Ä–∞–∑—Ä–µ–∑–µ –º–∞—Ä–æ–∫ –º–∞—à–∏–Ω, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏—Ö —Ä–∞–∑–Ω—ã–º —Ü–µ–Ω–æ–≤—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.")

if show_pairplot:
    st.subheader("–ü–æ–ø–∞—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤")
    with st.spinner("Pairplot –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è..."):
        try:
            fig = pairplots(df_cleaned)
            st.pyplot(fig)
            st.markdown("""
                –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
                1. –°–≤—è–∑—å —Ü–µ–Ω—ã –∏ –≥–æ–¥–∞ –≤—ã–ø—É—Å–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è, max_power, torque (—Å–ª–∞–±–µ–µ —á–µ–º –¥—Ä—É–≥–∏–µ –¥–≤–∞)
                2. –°–≤—è–∑—å year –∏ km_driven (—á—Ç–æ –≤–ø–æ–ª–Ω–µ –ª–æ–≥–∏—á–Ω–æ), max_power –∏ torque
                """)
        except Exception as e:
            st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ pairplot: {e}")



